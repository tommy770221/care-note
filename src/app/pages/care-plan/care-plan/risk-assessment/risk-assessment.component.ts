import { Component } from '@angular/core';
import { FormBuilder, FormGroup, FormArray, FormControl } from '@angular/forms';

@Component({
  selector: 'app-risk-assessment',
  templateUrl: './risk-assessment.component.html',
  styleUrl: './risk-assessment.component.scss'
})
export class RiskAssessmentComponent {
  riskAssessmentForm: FormGroup;
  assessmentCategories = [
    {
      name: '生理健康與功能評估',
      questions: [
        '視力清晰度（是否有白內障、青光眼等問題）',
        '聽力狀況（是否需要助聽器）',
        '口腔健康（是否有咀嚼或吞嚥困難）',
        '平衡能力（是否容易失去平衡）',
        '肌肉力量（是否能夠支撐自身重量）',
        '關節靈活性（是否有關節炎或僵硬問題）',
        '步行速度（是否緩慢或不穩）',
        '手部精細動作能力（是否能握筆、扣鈕扣）',
        '是否有慢性疼痛（如背痛、關節痛）',
        '是否有頭暈或昏厥的現象',
        '是否有呼吸困難',
        '是否有心臟疾病史',
        '是否有糖尿病',
        '是否有高血壓',
        '是否有骨質疏鬆',
        '是否有中風史',
        '是否有帕金森氏症',
        '是否有尿失禁問題',
        '是否有便秘或腹瀉問題',
        '是否有睡眠障礙（如失眠、睡眠呼吸中止）',
        '是否有營養不良的風險',
        '是否有脫水風險',
        '是否有藥物過敏史',
        '是否有多重用藥問題',
        '是否有定期服藥的習慣',
        '是否有藥物副作用（如頭暈、嗜睡）',
        '是否有跌倒史',
        '是否有骨折史',
        '是否有皮膚破損或褥瘡風險',
        '是否有感染風險（如泌尿道感染）',
        '是否有過敏性鼻炎',
        '是否有哮喘',
        '是否有慢性阻塞性肺病',
        '是否有胃食道逆流',
        '是否有肝臟疾病',
        '是否有腎臟疾病',
        '是否有甲狀腺問題',
        '是否有免疫系統疾病',
        '是否有癌症病史',
        '是否有手術史',
        '是否有過敏反應（如食物、藥物）',
        '是否有血液循環問題（如靜脈曲張）',
        '是否有神經系統疾病',
        '是否有代謝症候群',
        '是否有體重異常（過輕或過重）',
        '是否有體溫調節問題',
        '是否有皮膚乾燥或龜裂',
        '是否有視野缺損',
        '是否有聽力受損',
        '是否有嗅覺或味覺退化'
      ]
    },
    {
      name: '心理健康與認知功能評估',
      questions: [
        '是否有記憶力衰退現象',
        '是否有定向感問題（如時間、地點、人物混淆）',
        '是否有判斷力下降',
        '是否有語言表達困難',
        '是否有情緒波動（如易怒、焦慮）',
        '是否有憂鬱傾向',
        '是否有孤獨感',
        '是否有自殺意念',
        '是否有幻覺或妄想',
        '是否有焦慮症',
        '是否有強迫行為',
        '是否有睡眠障礙',
        '是否有對活動失去興趣',
        '是否有社交退縮現象',
        '是否有認知障礙（如失智症）',
        '是否有執行功能障礙（如計劃、組織能力下降）',
        '是否有注意力不集中',
        '是否有行為異常（如攻擊性、遊走）',
        '是否有對時間的認知混淆',
        '是否有對空間的認知混淆',
        '是否有對人物的認知混淆',
        '是否有對事件的認知混淆',
        '是否有對環境的認知混淆',
        '是否有對自我身份的認知混淆',
        '是否有對現實的認知混淆',
        '是否有對未來的認知混淆',
        '是否有對過去的認知混淆',
        '是否有對情感的認知混淆',
        '是否有對社交的認知混淆',
        '是否有對安全的認知混淆',
        '是否有對醫療資源的依賴',
        '是否有對照護資源的依賴',
        '是否有對社交資源的依賴',
        '是否有對娛樂資源的依賴',
        '是否有對教育資源的依賴',
        '是否有對交通資源的依賴',
        '是否有對安全資源的依賴',
        '是否有對法律資源的依賴',
        '是否有對經濟資源的依賴',
        '是否有對心理資源的依賴',
        '是否有對志工資源的依賴',
        '是否有對宗教資源的依賴',
        '是否有對文化資源的依賴',
        '是否有對環境資源的依賴',
        '是否有對健康資源的依賴',
        '是否有對營養資源的依賴',
        '是否有對活動資源的依賴',
        '是否有對緊急資源的依賴',
        '是否有對長期照護資源的依賴',
        '是否有對社會支持資源的依賴'
      ]
    },
    {
      name: '日常生活活動能力評估',
      questions: [
        '是否能獨立進食',
        '是否能使用餐具',
        '是否能準備簡單餐點',
        '是否能打開食品包裝',
        '是否能倒水或飲料',
        '是否能獨立穿衣',
        '是否能扣鈕扣或拉拉鍊',
        '是否能穿鞋襪',
        '是否能梳洗頭髮',
        '是否能刷牙',
        '是否能洗臉',
        '是否能刮鬍子或化妝',
        '是否能洗澡',
        '是否能使用浴室設備（如馬桶、洗手台）',
        '是否能上下床',
        '是否能整理床鋪',
        '是否能上下樓梯',
        '是否能使用交通工具',
        '是否能購物',
        '是否能管理金錢',
        '是否能接聽電話',
        '是否能使用手機或其他電子設備',
        '是否能閱讀書報',
        '是否能寫字',
        '是否能操作家電（如電視、微波爐）',
        '是否能清掃居家環境',
        '是否能洗衣',
        '是否能熨燙衣物',
        '是否能修剪指甲',
        '是否能處理緊急情況（如火災、跌倒）',
        '是否能使用電腦',
        '是否能使用網路',
        '是否能使用社交媒體',
        '是否能使用電子郵件',
        '是否能使用線上購物',
        '是否能使用線上銀行',
        '是否能使用線上醫療服務',
        '是否能使用線上娛樂',
        '是否能使用線上學習',
        '是否能使用線上社交'
      ]
    },
    {
      name: '社交與支持系統評估',
      questions: [
        '是否有固定社交活動',
        '是否有親友定期探訪',
        '是否參與社區活動',
        '是否有宗教信仰支持',
        '是否有鄰居協助',
        '是否有志工關懷',
        '是否有專業照護人員協助',
        '是否有經濟壓力',
        '是否有法律問題（如遺產規劃）',
        '是否有醫療保險',
        '是否有長期照護保險',
        '是否有緊急聯絡人',
        '是否有交通工具',
        '是否有網路使用習慣',
        '是否有與家人溝通困難',
        '是否有與照護者衝突',
        '是否有被忽視或虐待的風險',
        '是否有被詐騙的風險',
        '是否有孤獨死亡的風險',
        '是否有社會資源使用困難',
        '是否有社交孤立現象',
        '是否有社交焦慮',
        '是否有社交恐懼',
        '是否有社交退縮',
        '是否有社交依賴',
        '是否有社交衝突',
        '是否有社交支持不足',
        '是否有社交資源不足',
        '是否有社交活動不足',
        '是否有社交互動不足',
        '是否有對醫療資源的依賴',
        '是否有對照護資源的依賴',
        '是否有對社交資源的依賴',
        '是否有對娛樂資源的依賴',
        '是否有對教育資源的依賴',
        '是否有對交通資源的依賴',
        '是否有對安全資源的依賴',
        '是否有對法律資源的依賴',
        '是否有對經濟資源的依賴',
        '是否有對心理資源的依賴'
      ]
    },
    {
      name: '居家環境安全評估',
      questions: [
        '地面是否平整',
        '地面是否防滑',
        '是否有地毯或電線絆倒風險',
        '是否有足夠照明',
        '是否有夜燈設備',
        '家具擺設是否穩固',
        '是否有尖銳物品暴露',
        '是否有足夠的活動空間',
        '浴室是否有防滑墊',
        '浴室是否有扶手',
        '馬桶高度是否合適',
        '淋浴間是否有座椅',
        '廚房是否有滅火器',
        '廚房是否有煙霧偵測器',
        '瓦斯設備是否安全',
        '電器設備是否老舊',
        '是否有緊急呼叫裝置',
        '門鎖是否易於操作',
        '窗戶是否安全',
        '是否有寵物造成絆倒風險',
        '是否有雜物堆積',
        '是否有光線不足',
        '是否有通風不良',
        '是否有噪音問題',
        '是否有溫度調節問題',
        '是否有濕度調節問題',
        '是否有空氣品質問題',
        '是否有水質問題',
        '是否有電磁波問題',
        '是否有輻射問題'
      ]
    },
    {
      name: '外出與活動安全評估',
      questions: [
        '外出時是否有人陪同',
        '外出時是否攜帶身份證明',
        '外出時是否攜帶緊急聯絡資訊',
        '外出時是否攜帶藥物',
        '外出時是否攜帶飲用水',
        '外出時是否穿著合適的鞋子',
        '外出時是否使用輔助工具（如拐杖、輪椅）',
        '外出時是否注意交通安全',
        '外出時是否避免擁擠場所',
        '外出時是否避免高溫或寒冷環境',
        '外出時是否避免長時間曝曬',
        '外出時是否攜帶手機',
        '外出時是否知道回家的路',
        '外出時是否知道如何求助',
        '外出時是否知道如何應對突發狀況',
        '外出時是否知道如何避免詐騙',
        '外出時是否知道如何避免走失',
        '外出時是否知道如何避免跌倒',
        '外出時是否知道如何避免受傷',
        '外出時是否知道如何避免迷路'
      ]
    },
    {
      name: '其他特殊需求評估',
      questions: [
        '是否有語言溝通障礙',
        '是否有文化適應問題',
        '是否有性別特定需求',
        '是否有宗教信仰需求',
        '是否有飲食禁忌',
        '是否有過敏原',
        '是否有特殊醫療需求',
        '是否有特殊照護需求',
        '是否有特殊心理需求',
        '是否有特殊社交需求',
        '是否有特殊經濟需求',
        '是否有特殊法律需求',
        '是否有特殊環境需求',
        '是否有特殊活動需求',
        '是否有特殊教育需求',
        '是否有特殊娛樂需求',
        '是否有特殊交通需求',
        '是否有特殊安全需求',
        '是否有特殊健康需求',
        '是否有特殊營養需求'
      ]
    },
    {
      name: '照護者與家屬評估',
      questions: [
        '照護者是否有足夠的知識和技能',
        '照護者是否有足夠的時間和精力',
        '照護者是否有足夠的經濟支持',
        '照護者是否有足夠的社會支持',
        '照護者是否有足夠的心理支持',
        '照護者是否有足夠的身體健康',
        '照護者是否有足夠的耐心和愛心',
        '照護者是否有足夠的溝通能力',
        '照護者是否有足夠的應變能力',
        '照護者是否有足夠的學習能力',
        '照護者是否有足夠的團隊合作能力',
        '照護者是否有足夠的自我照顧能力',
        '照護者是否有足夠的休息時間',
        '照護者是否有足夠的娛樂時間',
        '照護者是否有足夠的社交時間',
        '照護者是否有足夠的經濟收入',
        '照護者是否有足夠的法律知識',
        '照護者是否有足夠的醫療知識',
        '照護者是否有足夠的心理健康',
        '照護者是否有足夠的身體健康'
      ]
    },
    {
      name: '社區與社會資源評估',
      questions: [
        '社區是否有足夠的醫療資源',
        '社區是否有足夠的照護資源',
        '社區是否有足夠的社交資源',
        '社區是否有足夠的娛樂資源',
        '社區是否有足夠的教育資源',
        '社區是否有足夠的交通資源',
        '社區是否有足夠的安全資源',
        '社區是否有足夠的法律資源',
        '社區是否有足夠的經濟資源',
        '社區是否有足夠的心理資源',
        '社區是否有足夠的志工資源',
        '社區是否有足夠的宗教資源',
        '社區是否有足夠的文化資源',
        '社區是否有足夠的環境資源',
        '社區是否有足夠的健康資源',
        '社區是否有足夠的營養資源',
        '社區是否有足夠的活動資源',
        '社區是否有足夠的緊急資源',
        '社區是否有足夠的長期照護資源',
        '社區是否有足夠的社會支持資源'
      ]
    },
    {
      name: '其他綜合評估',
      questions: [
        '是否有定期健康檢查',
        '是否有定期藥物評估',
        '是否有定期營養評估',
        '是否有定期心理評估',
        '是否有定期社交評估',
        '是否有定期環境評估',
        '是否有定期照護者評估',
        '是否有定期社區資源評估',
        '是否有定期風險評估',
        '是否有定期應變計劃評估',
        '是否有定期長期照護計劃評估',
        '是否有定期財務管理計劃評估',
        '是否有定期法律規劃計劃評估',
        '是否有定期健康監測計劃評估',
        '是否有定期疾病預防計劃評估',
        '是否有定期疼痛管理計劃評估',
        '是否有定期睡眠改善計劃評估',
        '是否有定期認知訓練計劃評估',
        '是否有定期情緒管理計劃評估',
        '是否有定期社交技能訓練計劃評估'
      ]
    }
  ];

  constructor(private fb: FormBuilder) {
    this.riskAssessmentForm = this.fb.group({
      categories: this.fb.array([])
    });
  }

  ngOnInit(): void {
    this.initializeForm();
  }

  initializeForm(): void {
    const categoriesArray = this.riskAssessmentForm.get('categories') as FormArray;
    this.assessmentCategories.forEach(category => {
      const categoryGroup = this.fb.group({
        name: category.name,
        questions: this.createQuestionsArray(category.questions)
      });
      categoriesArray.push(categoryGroup);
    });
  }

  createQuestionsArray(questions: string[]): FormArray {
    return this.fb.array(questions.map(question => this.fb.group({
      question: question,
      riskLevel: '',
      preventionMeasures: ''
    })));
  }

  get categories(): FormArray {
    return this.riskAssessmentForm.get('categories') as FormArray;
  }

  getQuestions(categoryIndex: number): FormArray {
    return this.categories.at(categoryIndex).get('questions') as FormArray;
  }

  onSubmit(): void {
    console.log(this.riskAssessmentForm.value);
  }
}
